#!/bin/bash
#
#  Synopsis:
#	Profile for typical fffile5 flowd, using version 5 file.
#  Usage:
#	. $SETSPACE_ROOT/fffile5/etc/profile
#

#
#  Note:
#	Must point to version 5 of file built from github.
#
#		https://github.com/file/file
#
FFFILE5_PATH=/usr/local/fffile

PATH=$FFFILE5_DIST/bin:$PATH

SCHEMA_ROOT=$SETSPACE_ROOT/schema/fffile5
export TMPDIR=$SCHEMA_ROOT/tmp

export FFFILE5_ROOT=${FFFILE5_ROOT:=$SCHEMA_ROOT}

#  create the spool file so tail doesn't abort.
#  Note: got to be a better way. perhaps flowd.tail ought to create the file.
BRR=$SCHEMA_ROOT/spool/setcore.brr
touch $BRR
chmod u=rw,g=w,o= $BRR

PATH=$SCHEMA_ROOT/sbin:$SCHEMA_ROOT/bin:$PATH

#
#  Verify 'file' command is version 5.
#
PATH=$FFFILE_PATH:$PATH
FFFILE5_VERSION=$(file --version | head)
case "$FFFILE5_VERSION" in
file-5.*)
	;;
*)
	echo "ERROR: unknown 'file' version: $FFFILE5_VERSION" >&2
	exit 1
	;;
esac

#
#  insure file can identify a json document.
#  Many versions of 'file' fail (fedora 33), but
#  github source version
#
TEST_JSON=$(file test.json)

case "$TEST_JSON" in
'lib/test.json: JSON data')
	;;
*)
	echo "ERROR: test.json failed: is file correct version: $TEST_JSON">&2
	exit 1
	;;
esac
